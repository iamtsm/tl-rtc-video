!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n,o=t();for(n in o)("object"==typeof exports?exports:e)[n]=o[n]}}(this,function(){return o={},r.m=n={"../../res/js/tl-comm.js":
/*!*************************************************************!*\
  !*** E:/code/tl-open-source/tl-rtc-video/res/js/tl-comm.js ***!
  \*************************************************************/
/*! no static exports found */function(e,t){var n,r,o,i,c,d;n={init:function(e,t){n.socket=e,n.id=t},on:function(e,t){n.socket.on(e,t)},onCreated:function(e){n.on("created",e)},onJoined:function(e){n.on("joined",e)},onOffer:function(e){n.on("offer",e)},onAnswer:function(e){n.on("answer",e)},onCandidate:function(e){n.on("candidate",e)},onExit:function(e){n.on("exit",e)},emit:function(e,t){n.socket.emit(e,t)},emitCreate:function(e){n.emit("created",e)},emitJoin:function(e){n.emit("joined",e)},emitOffer:function(e){n.emit("offer",e)},emitAnswer:function(e){n.emit("answer",e)},emitCandidate:function(e){n.emit("candidate",e)},emitExit:function(e){n.emit("exit",e)},emitCreateAndJoin:function(e){n.emit("createAndJoin",e)}},window.tlSocket=n,r={init:function(e,t,n,o){r.config=e,r.options=t,r.LOCAL_STREAM=n,r.connects=o},initStream:function(e){document.querySelector("#self-video").srcObject=e,navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&document.querySelector("#self-video").play(),r.LOCAL_STREAM=e},addConnect:function(e,t){r.connects.push({id:t,connect:e}),tlVue.Bus.$emit("addConnect",r.connects)},removeConnect:function(t){let e=r.getConnect(t);e&&e.close(),r.connects=r.connects.filter(e=>e.id!==t)},createConnect:function(n){if(r.LOCAL_STREAM){let t=new RTCPeerConnection(r.config);t.onicecandidate=e=>{e.candidate&&r.iceCandidateSuccess(n,e.candidate)},t.ontrack=t=>{var e=r.getConnect(n);e||r.addConnect(e,n),setTimeout(()=>{let e=document.querySelector("#tl"+n);e.srcObject=t.streams[0],navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&e.play()},100)},r.LOCAL_STREAM.getTracks().forEach(function(e){t.addTrack(e,r.LOCAL_STREAM)}),t.onremovestream=e=>{r.removeConnect(n)},r.addConnect(t,n)}else tlLayer.msg("LOCAL_STREAM err")},getConnect:function(t){var e=r.connects.filter(e=>e.id===t);return e&&1===e.length?e[0].connect:null},getOrCreateConnect:function(e){return r.getConnect(e)||r.createConnect(e),r.getConnect(e)},createPeers:function(e){var o=e.peers||[];tlSocket.id=e.id,tlRoom.id=e.room;for(let n=0;n<o.length;n++){let t=o[n].id,e=r.getOrCreateConnect(t);e.createOffer(r.options).then(e=>{r.offerSuccess(t,e)}).catch(e=>{console.error("err in createPeers"+t,e)})}},joinPeers:function(e){r.getOrCreateConnect(e.id)},offer:function(t){let e=r.getOrCreateConnect(t.from);var n={type:"offer",sdp:t.sdp};e.setRemoteDescription(new RTCSessionDescription(n)).then(e=>{}),e.createAnswer(r.options).then(e=>{r.answerSuccess(t.from,e)}).catch(e=>{console.error("err in offer "+t.from,e)})},answer:function(t){let e=r.getOrCreateConnect(t.from);var n={type:"answer",sdp:t.sdp};e.setRemoteDescription(new RTCSessionDescription(n)).then(e=>{}).catch(e=>{console.error("err in answer "+t.from,e)})},candidate:function(t){let e=r.getOrCreateConnect(t.from);var n=new RTCIceCandidate({candidate:t.sdp,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex});e.addIceCandidate(n).then(e=>{}).catch(e=>{console.error("err in candidate "+t.from,e)})},offerSuccess:function(e,t){let n=r.getConnect(e);n&&(n.setLocalDescription(t).then(e=>{}),tlSocket.emitOffer({from:tlSocket.id,to:e,room:tlRoom.id,sdp:t.sdp}))},answerSuccess:function(e,t){let n=r.getConnect(e);n&&(n.setLocalDescription(t).then(e=>{}),tlSocket.emitAnswer({from:tlSocket.id,to:e,room:tlRoom.id,sdp:t.sdp}))},iceCandidateSuccess:function(e,t){tlSocket.emitCandidate({from:tlSocket.id,to:e,room:tlRoom.id,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,sdp:t.candidate})}},window.tlWebrtc=r,i={msg:function(e){window.layer?window.layer.msg(e):alert(e)},close:function(e){window.layer&&window.layer.close(e)},confirm:function(e,t,n){window.layer?window.layer.confirm(e,{btn:["进入","退出"]},t,n):window.confirm(e)}},window.tlLayer=i,o={init:function(e,t){o.id=e,setTimeout(async()=>{var e=await o.getVideoStream();t&&t(e)},500)},getVideoStream:async function(){var e=navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0},video:!0});let t=null;try{t=await e}catch(e){console.error(e)}return null==t?(tlLayer.msg("get stream err"),!1):(tlWebrtc.initStream(t),!0)}},window.tlRoom=o,i={code:function(e){return"https://blog.iamtsm.cn/share/code/url?url="+encodeURIComponent(e)}},window.tlQrcode=i,c={init:function(){c.Bus=new Vue({})}},window.tlVue=c,d={init:function(){d.SLIDE_COUNT=5,d.MIN_WIDTH=700,d.VERTICAL="vertical",d.HORIZONTAL="horizontal",d.doms=[]},count:function(){var e=document.body.clientWidth;let t=parseInt(e/100)-2;return t>=d.SLIDE_COUNT&&(t=d.SLIDE_COUNT),t},autoPreview:function(e){setTimeout(()=>{document.body.clientWidth>=d.MIN_WIDTH?d.prepare(e,d.VERTICAL):d.prepare(e,d.HORIZONTAL)},800)},preview:function(e,t){setTimeout(()=>{d.prepare(e,t)},800)},prepare:function(e,t){d.doms[e]&&d.doms[e].destroy(!0,!0);t=new window.Swiper(e,{direction:t,loop:!1,slidesPerView:d.count(),observer:!0});d.doms[e]=t}},window.tlSwiper=d}},r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="../../res/js/tl-comm.js");function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var n,o});